<!-- JavaNLP MT5 build file -->

<project name="mt" default="compile" basedir=".">
  <property name="project.core"   value="${basedir}/../core" />
  <property name="project.more"   value="${basedir}/../more" />
  <property name="build.path"     value="${basedir}/classes" />
  <property name="source.path"    value="${basedir}/src" />
  <property name="tests.path"     value="${basedir}/test/src" />
  <property name="itests.path"     value="${basedir}/itest/src" />
  
  <property name="compile.debug"       value="true"/>
  <property name="compile.deprecation" value="false"/>
  <property name="compile.optimize"    value="true"/>
  <property name="compile.source"      value="1.6" />
  <property name="compile.target"      value="1.6" />
  <property name="compile.encoding"    value="utf-8" />

  <target name="classpath" description="Sets the classpath">
    <echo message="${ant.project.name}" />
    <path id="classpath">
      <!-- depends on core -->
      <fileset dir="${project.core}/lib">
        <include name="*.jar"/>
        <exclude name="javanlp*"/>
      </fileset>
      <pathelement path="${project.core}/classes" />
	  
	  <!-- depends on more -->
      <fileset dir="${project.more}/lib">
        <include name="*.jar"/>
        <exclude name="javanlp*"/>
      </fileset>
      <pathelement path="${project.more}/classes" />
      
      <!-- depends on local libs -->
      <fileset dir="${basedir}/lib">
        <include name="*.jar"/>
        <exclude name="javanlp*"/>
      </fileset>
    </path>
  </target>
  
  <target name="clean" description="Delete old classes">
    <echo message="${ant.project.name}" />
    <delete includeemptydirs="true">
       <fileset dir="${build.path}/" includes="**/*"/>
     </delete>
  </target>

  <target name="compile" depends="classpath"
          description="Compile core sources">
    <echo message="${ant.project.name}" />
    <mkdir    dir="${build.path}" />
    <javac srcdir="${source.path}:${tests.path}:${itests.path}"
          destdir="${build.path}"
            debug="${compile.debug}"
         encoding="utf-8"   
      deprecation="${compile.deprecation}"
         optimize="${compile.optimize}"
           source="${compile.source}"
           target="${compile.target}"
includeantruntime="false">
        <classpath refid="classpath" />
      <!-- <compilerarg value="-Xmaxerrs"/>
           <compilerarg value="20"/> -->
      <!-- <compilerarg value="-Xlint"/> -->
    </javac>
    <!-- Copy application resources -->
    <copy  todir="${build.path}">
      <fileset dir="${source.path}" excludes="**/*.java,**/*.html"/>
    </copy>
  </target>
 
  <target name="test" depends="classpath"
          description="Run mt unit tests">
    <echo message="${ant.project.name}" />
    <junit fork="true" maxmemory="1g" printsummary="off" outputtoformatters="false" forkmode="perBatch" haltonfailure="true">
      <classpath refid="classpath"/>
      <classpath path="${build.path}"/>
      <formatter type="brief" usefile="false"/>
      <batchtest fork="yes">
        <fileset dir="${tests.path}">
          <include name="**/*Test.java"/>
          <exclude name="**/*ITest.java"/>
        </fileset>
      </batchtest>
    </junit>
  </target>
  
  <target name="itest" depends="classpath"
          description="Run mt integration tests">
    <echo message="${ant.project.name}" />
    <junit fork="true" maxmemory="2g" printsummary="off" outputtoformatters="false" forkmode="perBatch" haltonfailure="true">
      <classpath refid="classpath"/>
      <classpath path="${build.path}"/>
      <formatter type="brief" usefile="false"/>
      <batchtest fork="yes">
        <fileset dir="${tests.path}">
          <include name="**/*ITest.java"/>
        </fileset>
      </batchtest>
    </junit>
  </target>


  <!-- TestNG stuff here  -->
  <property name="testng.src"     value="${basedir}/testng/src" />
  <property name="testng.classes"     value="${basedir}/testng/classes" />
  <property name="testng.reports"     value="${basedir}/testng/reports" />
  <property name="testng.jar"  value="${basedir}/lib/testng.jar" />
  <taskdef resource="testngtasks"  classpath="${testng.jar}"/>

  <path id="testng.classpath">
    <pathelement location="${testng.jar}" />
    <pathelement location="${build.path}" />
    <pathelement location="${project.core}/classes" />
  </path>

  <path id="runtests.classpath">
    <path refid="testng.classpath"/>
    <pathelement location="${testng.classes}" />
  </path>

  <target name="compiletests" depends="compile" description="Compile testng test classes">
    <mkdir dir="${testng.classes}"/>
    <javac srcdir="${testng.src}"
	   destdir="${testng.classes}" 
           encoding="utf-8"   
           classpathref="testng.classpath"
	   includes="**/*.java" />
  </target>

  <target name="runtests" depends="compiletests" description="Run TestNG unit tests">
    <mkdir dir="${testng.reports}"/>
    <testng classpathref="runtests.classpath" outputDir="${testng.reports}" 
            verbose="2" haltonfailure="true">
      <classfileset dir="${testng.classes}" includes="**/*.class" />
    </testng>
  </target>


  <target name="cleantests" description="Delete old testng classes and reports">
    <echo message="${ant.project.name}" />
    <delete includeemptydirs="true">
       <fileset dir="${testng.classes}/" includes="**/*"/>
       <fileset dir="${testng.reports}/" includes="**/*"/>
     </delete>
  </target>

  <!-- End of TestNG stuff -->

  <target name="all" depends="clean,compile"
          description="Clean and re-compile." />

</project>

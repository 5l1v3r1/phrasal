// setup-tr.js
// Register ptm callbacks with the translation manager interface
//
// Requires:
//   jquery-latest.js
//   translog2.js
//   timer-widget.js
//
$(document).ready(function(){
  // DEBUG: Uncomment this to disable logging
  console.log = function() {}

  // Setup the translation text area
  // CSS ids generated by tm.tm_forms.TranslationInputForm
  var _textAreaId = 'id_txt';
  var _textAreaSel = 'textarea#' + _textAreaId;
  $( _textAreaSel ).focus();

  var _cssDir = $( 'input[name=css_direction]' ).val();
  if (_cssDir == 'rtl'){
    console.log('rtl language');
    $( _textAreaSel ).css('direction','rtl');
    $( _textAreaSel ).css('text-align','right');
  } else {
    $( _textAreaSel ).css('direction','ltr');
    $( _textAreaSel ).css('text-align','left');
  }
  
  // Translog2 --- User action logging
  tlog2.init();
  $( 'input[name=form-tgt-submit]' ).click(function(){
    tlog2.flushForm('action_log');
  });

  // Setup the idle timer
  var max_secs = 180;
  idletimer.init(max_secs);
  idletimer.addCallback(function(){
    alert('You exceeded the maximum idle time! Your partial translation has been submitted. Click OK to continue to the next sentence.');
    $( 'input[name=is_valid]' ).val('False');
    var partialHypothesis = $( _textAreaSel ).val();
    if (partialHypothesis.length == 0){
      $( _textAreaSel ).val('INCOMPLETE');
    }
    $( 'input[name=form-tgt-submit]' ).trigger('click');
  });
  $( _textAreaSel ).keydown(function(){
    idletimer.reset();
  });
  idletimer.show();
  
});
